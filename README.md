# exam-sim

このプロジェクトは “問題を配るサービス” ではなく、ユーザーが手元に持っている問題セットを使って学習するための **試験風UI＋進捗管理** ツールを目指します。

- **模試アプリ（学習UI・進捗管理）**: 問題セットJSONを読み込み、回答・正誤・履歴・メモなどを管理（将来的には問題セットもユーザー単位で保存して端末間同期）
- **（別アプリ）スクレイピング/変換ツール**: どこかのサイトからの取得・整形は将来的に別プロダクト/別ツールとして分離（運営リスク低減）

## 将来方針（バックエンド追加でユーザー別に管理）

将来的には **バックエンド（認証 + DB + API）** を追加し、ログインしたユーザーごとに以下を保存・同期できる構成にします。

- **ユーザー別の進捗**: 回答履歴、正誤、復習キュー、メモ等
- **ユーザー別の問題セット管理**: JSONアップロードした問題セットの保存・削除・（将来）エクスポート

現時点のローカルMVPでは、問題セットはブラウザで読み込み、進捗はブラウザの `localStorage` に保存します（サーバー保存はしません）。

## 設計方針

### 目的

資格試験の学習用に、本番試験に近い体験で問題演習できるUI（試験風UI）と、進捗・復習管理（正誤、履歴、弱点、復習キューなど）を提供する。

- **PCとモバイルの両方** で使える
- **自分だけでなく他の人も使える形（SaaS/公開Webアプリ）** も視野
- ただし、特定サイト由来の問題本文は権利/規約の観点でグレーになり得るため、運営が問題本文を **収集・保管・配信** する構造は避ける

### 前提と課題認識

- **課題1（運営リスク）**: 問題本文をサーバーに置くと「配信基盤」に見えやすく、運営リスクが上がる
- **課題2（端末間同期）**: Webだけで端末間同期を実現したい（毎回JSONアップロードはUXが悪い）

### 採用する結論（将来像）：ユーザーアップロード＋ユーザー単位のプライベート保存

ユーザーが `examples/*.questions.json` のような形式のJSONをアップロードし、**問題セットとユーザー進捗を同じアカウント配下で保存**して端末間同期する。

- **サーバーが持つもの**: 認証、問題セット（ユーザー単位・非公開）、進捗・履歴
- **ユーザー体験**: 初回にJSONをアップロードすれば、以降はログインだけで **問題セット＋進捗が同期**される

### セーフティ/ガードレール（意図的に“配信基盤”化しない）

- 共有リンク配布・公開ライブラリ・全文検索など **配布に近い機能** は作らない
- 他ユーザーが閲覧できる「公開」を前提にしない（問題セットは **ユーザー単位のプライベートデータ**）
- 問題セットはユーザーがいつでも削除できる（データポータビリティ: エクスポートも将来対応）

### システム全体像（将来像）

- **公開Webアプリ（学習UI・進捗管理）**

- 試験風UI（選択、見直しフラグ、タイマー、ナビゲーションなど）
- 進捗・統計（正答率、分野別弱点、履歴）
- 復習（例: 間隔反復キュー）
- ログイン（ユーザー別に進捗同期）

- **アプリ側ストレージ（ユーザー単位・非公開）**

- ユーザーがアップロードした問題セットJSON（`questions.json`）を保存
- 進捗データ（回答履歴、正誤、復習キュー等）も同じアカウント配下で保存

- **（任意）ローカル変換ツール（スクレイピング/整形）**

- Webアプリとは分離（別プロダクト/別ツール）
- 三店方式のイメージ

### インポート/エクスポート（将来）

想定フロー:

1. ユーザーが `questions.json` をアップロード（または外部ストレージから取り込み）
2. アプリがJSONを検証して「問題セット」として登録
3. 以降はログイン時に **問題セット＋進捗** を同期して学習
4. いつでも「問題セットの削除」「JSONとしての書き出し（エクスポート）」ができる

### データの持ち方

- **サーバー（公開Webアプリ側）**: 認証、問題セット（ユーザー単位・非公開）、進捗・履歴
- **クライアント（ブラウザ）**: 学習のために問題本文を表示（将来: キャッシュ/オフライン対応）

## このリポジトリの「いま」（ローカルMVP）

現時点は “将来のユーザー単位プライベート保存（問題セット＋進捗同期）Webアプリ” へ移行しやすいように、まずローカルで以下を分離しています。

- `frontend/`: **フロントエンド（Next.js）**（問題セットJSONを読み込み、進捗はブラウザに保存）
- `question_set_tools/`: **スクレイピング/変換ツール（CLI / ローカル専用）**

## 問題セットJSON形式（v1）

模試アプリは、ユーザーが用意した `questions.json` を読み込みます。

最小構成:

```json
{
  "set_id": "example-set",
  "questions": [
    {
      "id": "q1",
      "text": "Question text...",
      "choices": [
        { "id": "A", "text": "Choice A" },
        { "id": "B", "text": "Choice B" }
      ],
      "answer_choice_ids": ["A"],
      "explanation": "Optional explanation",
      "tags": ["optional", "tags"]
    }
  ]
}
```

- `answer_choice_ids` が無い/`null` の場合、正誤は **不明** として扱います（学習UIは回せる）
- 現状のUIは **単一選択** を前提（将来、複数選択に拡張可能）

## セットアップ

```bash
uv venv .venv
source .venv/bin/activate
uv sync
```

依存関係の追加/更新は `pyproject.toml` を唯一の正として `uv` で行います。

```bash
uv add <package>
uv remove <package>
uv sync
```

## 起動

### Webアプリ（Next.js / ローカルMVP: ブラウザ読込＋localStorage進捗）

`frontend/` 配下に Next.js 版の学習UI（MVP）があります。

- 問題セットJSONは **ブラウザで読み込み**（サーバーに保存しません）
- 進捗は **ブラウザの localStorage** に保存（キー: `set_id + userId`）

```bash
cd frontend
npm install
npm run dev
```

起動後、画面左の「サンプルを読み込む」またはJSONアップロードで学習を開始できます。

### スクレイピングツール（CLI / ローカル）

URL収集（ディスカッション一覧ページ → URLリスト）:

```bash
uv run python -m question_set_tools.cli collect-urls \
  --category amazon/ \
  --max-page 575 \
  --keyword SAP-C02 \
  --out urls.txt
```

スクレイプ（URLリスト → questions.json）:

```bash
uv run python -m question_set_tools.cli scrape \
  --set-id AWS-SAP-C02 \
  --urls urls.txt \
  --out AWS-SAP-C02.questions.json \
  --cache scrape-cache.json
```

## 今後の実装ステップ（MVP優先順位）

1. Webアプリ（試験UI + 問題セット保存 + 進捗同期）を先に完成
2. 統計・復習（弱点分析、間隔反復）
3. インポート/エクスポート（JSON）とデータ削除（ユーザーコントロール）
